<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"
        integrity="sha512-KZmyTq3PLx9EZl0RHShHQuXtrvdJ+m35tuOiwlcZfs/rE7NZv29ygNA8SFCkMXTnYZQK2OX0Gm2qKGfvWEtRXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 1500,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body ng-app="myApp">
    <div class="card" ng-controller="charactorController">
        <div class="card-header">
            <div class="row">
                <div class="col-4">
                    <span class="fs-5">Danh sách nhân vật</span>
                </div>
                <div class="col-4">
                    <div class="input-group ">
                        <button class="btn btn-outline-secondary" type="button" ng-click="reset()">Khôi phục</button>
                        <input type="text" class="form-control" placeholder="Nhập tên nhân vật ..." id="name" autocomplete="off">
                        <button class="btn btn-outline-secondary" type="button" ng-click="search()">Tìm
                            kiếm</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <button class="btn btn-primary mt-3 mb-3" ng-click="showModal(-1)">Thêm mới</button>
            <table class="table table-hover">
                <thead>
                    <th>Id</th>
                    <th>Tên nhân vật</th>
                    <th colspan="2"></th>
                </thead>
                <tbody>
                    <tr ng-repeat="charactor in charactors.content">
                        <td>
                            {{charactor.id}}
                        </td>
                        <td>
                            {{charactor.value}}
                        </td>
                        <td>
                            <a href=""><i class="fa-solid fa-pen-to-square" ng-click="showModal($index)"></i></a>
                        </td>
                        <td>
                            <a href="" ng-click="delete($index)"><i class="fa-solid fa-trash"></i></a>
                        </td>
                    </tr>
                </tbody>
                <tfoot ng-show="charactors.totalPages!=0">
                    <tr>
                        <td colspan="6">
                            <div class="d-flex justify-content-center mt-3">
                                <button class="btn btn-primary me-3" ng-click="getCharactor(0)" ng-disabled="page==0">
                                    <span class="fas fa-backward"></span>
                                </button>
                                <button class="btn btn-primary me-3" ng-click="getCharactor(page-1)"
                                    ng-disabled="page==0"><span class="fas fa-backward-step"></span></button>
                                <h4>{{charactors.pageable.pageNumber+1}}/{{charactors.totalPages}}</h4>
                                <button class="btn btn-primary ms-3 me-3" ng-click="getCharactor(page+1)"
                                    ng-disabled="page==charactors.totalPages-1"><span
                                        class="fas fa-forward-step"></span></button>
                                <button class="btn btn-primary" ng-click="getCharactor(charactors.totalPages-1)"
                                    ng-disabled="page==charactors.totalPages-1">
                                    <span class="fas fa-forward"></span>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="modal fade" id="modalDelete" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Cảnh báo</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Bạn có chắc muốn xóa nhân vật này?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Không</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" ng-click="onDelete()">Chắc
                            chắn</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="modalEdit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Nhập tên nhân vật</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-4">
                                <label for="name" class="fs-5">Tên nhân vật: </label>
                            </div>
                            <di class="col-8">
                                <input type="text" class="form-control" id="value" autocomplete="off">
                            </di>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                            ng-click="index=-1">Đóng</button>
                        <button type="button" class="btn btn-primary" ng-click="confirmSave()">Lưu</button>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="modalConfirm" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Xác nhận lưu thay đổi</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                Bạn có chắc muốn lưu thay đổi này?
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                ng-click="index=-1">Đóng</button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                ng-click="save()">Lưu</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            const app = angular.module("myApp", []);
            app.controller("charactorController", function ($scope, $http) {
                $scope.page = 0;
                $scope.charactors = {}
                $scope.index = -1;
                $scope.name = "";
                $http.get("/api/admin/charactor/?page=0&value=").then(function (response) {
                    $scope.charactors = response.data;
                })
                $scope.confirmSave = function () {
                    $("#modalConfirm").modal("show");
                    console.log(1)
                }
                $scope.showModal = function (index) {
                    $scope.index = index;
                    if (index == -1) {
                        $("#value").val("");
                    } else {
                        $("#value").val($scope.charactors.content[index].value);
                    }
                    $("#modalEdit").modal("show");
                }
                $scope.save = function () {
                    let url = "/api/admin/charactor";
                    if ($scope.index == -1) {
                        let data = $("#value").val();
                        data = data == "" ? "  " : data;
                        $http.post("/api/admin/charactor", data).then(function (response) {
                            if (response.data.statusCode == "ok") {
                                Toast.fire({
                                    icon: 'success',
                                    title: response.data.data
                                })
                                $("#modalEdit").modal("hide");
                                $http.get("/api/admin/charactor/?page=0&value=" + $scope.name).then(function (response) {
                                    $scope.charactors = response.data;
                                })
                            } else {
                                Toast.fire({
                                    icon: 'error',
                                    title: response.data.data
                                })
                            }
                        })
                    } else {
                        let value = $("#value").val();
                        let data = {
                            "id": $scope.charactors.content[$scope.index].id,
                            "value": value
                        }
                        $http.put("/api/admin/charactor", data).then(function (response) {
                            if (response.data.statusCode == "ok") {
                                Toast.fire({
                                    icon: 'success',
                                    title: response.data.data
                                })
                                $("#modalEdit").modal("hide");
                                $scope.charactors.content[$scope.index].value = value;
                            } else {
                                Toast.fire({
                                    icon: 'error',
                                    title: response.data.data
                                })
                            }
                        })
                    }
                }
                $scope.delete = function (index) {
                    $scope.index = index;
                    $("#modalDelete").modal("show");
                }
                $scope.onDelete = function () {
                    $http.delete("/api/admin/charactor/" + $scope.charactors.content[$scope.index].id).then(function (response) {
                        if (response.data.statusCode == "ok") {
                            Toast.fire({
                                icon: 'success',
                                title: response.data.data
                            })
                            $scope.getCharactor($scope.page);
                            $scope.charactors.content[$scope.index].value = value;
                        } else {
                            Toast.fire({
                                icon: 'error',
                                title: response.data.data
                            })
                        }
                        $("#modalDelete").modal("hide");
                    })
                }
                $scope.getCharactor = function (page) {
                    $scope.page = page;
                    $http.get("/api/admin/charactor/?page="+page+"&value="+$scope.name).then(function (response) {
                        $scope.charactors = response.data;
                    })
                }
                $scope.search=function(){
                    $scope.name=$("#name").val();
                    $scope.getCharactor(0);
                }
                $scope.reset=function(){
                    $scope.name="";
                    $scope.page=0;
                    $("#name").val("");
                    $scope.getCharactor(0);
                }
            })
        </script>
</body>

</html>